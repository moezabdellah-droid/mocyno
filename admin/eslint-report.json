[{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\App.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[857,860],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[857,860],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Admin, Resource, CustomRoutes } from 'react-admin';\nimport { Route } from 'react-router-dom';\nimport { authProvider } from './authProvider';\nimport dataProvider from './dataProvider';\nimport Planning from './pages/Planning';\nimport { ConsigneList, ConsigneCreate, ConsigneEdit, ConsigneShow } from './pages/Consignes';\nimport { EventList, EventShow } from './pages/Events';\nimport Payroll from './pages/Payroll';\nimport { AgentList, AgentCreate, AgentEdit } from './pages/Agents';\nimport Profile from './pages/Profile';\nimport Dashboard from './Dashboard';\nimport { mocynoTheme } from './theme';\n\nimport CustomLoginPage from './LoginPage';\nimport MyLayout from './MyLayout';\nimport { SiteList, SiteCreate, SiteEdit } from './pages/Sites';\n\n// Wrapper component to check permissions before rendering Planning\nconst PlanningWithPermissions = (props: any) => {\n  // This will be handled by React Admin's built-in permission system\n  return <Planning {...props} />;\n};\n\nconst App = () => (\n  <Admin\n    authProvider={authProvider}\n    dataProvider={dataProvider}\n    loginPage={CustomLoginPage}\n    layout={MyLayout}\n    dashboard={Dashboard}\n    theme={mocynoTheme}\n  >\n    <Resource\n      name=\"planning\"\n      list={PlanningWithPermissions}\n      options={{ label: 'Planning' }}\n    />\n    <Resource name=\"payroll\" list={Payroll} options={{ label: 'RH & Export' }} />\n    <Resource name=\"agents\" list={AgentList} create={AgentCreate} edit={AgentEdit} />\n    <Resource name=\"sites\" list={SiteList} create={SiteCreate} edit={SiteEdit} />\n    <Resource name=\"consignes\" list={ConsigneList} create={ConsigneCreate} edit={ConsigneEdit} show={ConsigneShow} options={{ label: 'Consignes' }} />\n    <Resource name=\"events\" list={EventList} show={EventShow} options={{ label: 'Main Courante' }} />\n    <CustomRoutes>\n      <Route path=\"/profile\" element={<Profile />} />\n    </CustomRoutes>\n  </Admin>\n);\n\nexport default App;\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Do not use \"@ts-nocheck\" because it alters compilation errors.","line":1,"column":1,"nodeType":"Line","messageId":"tsDirectiveComment","endLine":1,"endColumn":15},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":10,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":10,"endColumn":14,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[478,491],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\nimport { useMemo } from 'react';\r\nimport { Card, CardContent, CardHeader, Grid, Typography, Box, CircularProgress, Paper } from '@mui/material';\r\nimport { useGetList, Title } from 'react-admin';\r\nimport CheckCircleIcon from '@mui/icons-material/CheckCircle';\r\nimport AccessTimeIcon from '@mui/icons-material/AccessTime';\r\nimport GroupIcon from '@mui/icons-material/Group';\r\nimport BusinessIcon from '@mui/icons-material/Business';\r\nimport moment from 'moment';\r\n// @ts-ignore\r\nimport 'moment/dist/locale/fr';\r\nimport { calculateMissionStats } from './utils/planningUtils';\r\nimport { Mission } from './types/models';\r\n\r\nmoment.locale('fr');\r\n\r\nconst Dashboard = () => {\r\n    const { data: planning, isLoading } = useGetList('planning');\r\n\r\n    const stats = useMemo(() => {\r\n        if (!planning) return { doneHours: 0, futureHours: 0, agentsCount: 0, sitesCount: 0 };\r\n        return calculateMissionStats(planning as Mission[]);\r\n    }, [planning]);\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <Box display=\"flex\" justifyContent=\"center\" alignItems=\"center\" minHeight=\"50vh\">\r\n                <CircularProgress />\r\n            </Box>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <Box>\r\n            <Title title=\"Tableau de Bord\" />\r\n\r\n            <Card sx={{ mb: 3 }}>\r\n                <CardHeader title=\"Bienvenue sur Mo'Cyno Admin\" />\r\n                <CardContent>\r\n                    <Typography color=\"textSecondary\">\r\n                        Voici un aperçu de l'activité de votre agence.\r\n                    </Typography>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <Grid container spacing={3}>\r\n                <Grid xs={12} sm={6} md={3}>\r\n                    <Paper elevation={3} sx={{ p: 3, display: 'flex', alignItems: 'center', height: '100%', borderLeft: '5px solid #2e7d32' }}>\r\n                        <CheckCircleIcon sx={{ fontSize: 50, color: '#2e7d32', mr: 2 }} />\r\n                        <Box>\r\n                            <Typography variant=\"h4\" fontWeight=\"bold\">\r\n                                {stats.doneHours.toFixed(0)}h\r\n                            </Typography>\r\n                            <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n                                Heures Effectuées\r\n                            </Typography>\r\n                        </Box>\r\n                    </Paper>\r\n                </Grid>\r\n\r\n                <Grid xs={12} sm={6} md={3}>\r\n                    <Paper elevation={3} sx={{ p: 3, display: 'flex', alignItems: 'center', height: '100%', borderLeft: '5px solid #1976d2' }}>\r\n                        <AccessTimeIcon sx={{ fontSize: 50, color: '#1976d2', mr: 2 }} />\r\n                        <Box>\r\n                            <Typography variant=\"h4\" fontWeight=\"bold\">\r\n                                {stats.futureHours.toFixed(0)}h\r\n                            </Typography>\r\n                            <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n                                Heures Planifiées (Futur)\r\n                            </Typography>\r\n                        </Box>\r\n                    </Paper>\r\n                </Grid>\r\n\r\n                <Grid xs={12} sm={6} md={3}>\r\n                    <Paper elevation={3} sx={{ p: 3, display: 'flex', alignItems: 'center', height: '100%', borderLeft: '5px solid #0288d1' }}>\r\n                        <GroupIcon sx={{ fontSize: 50, color: '#0288d1', mr: 2 }} />\r\n                        <Box>\r\n                            <Typography variant=\"h4\" fontWeight=\"bold\">\r\n                                {stats.agentsCount}\r\n                            </Typography>\r\n                            <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n                                Agents Mobilisés\r\n                            </Typography>\r\n                        </Box>\r\n                    </Paper>\r\n                </Grid>\r\n\r\n                <Grid xs={12} sm={6} md={3}>\r\n                    <Paper elevation={3} sx={{ p: 3, display: 'flex', alignItems: 'center', height: '100%', borderLeft: '5px solid #ed6c02' }}>\r\n                        <BusinessIcon sx={{ fontSize: 50, color: '#ed6c02', mr: 2 }} />\r\n                        <Box>\r\n                            <Typography variant=\"h4\" fontWeight=\"bold\">\r\n                                {stats.sitesCount}\r\n                            </Typography>\r\n                            <Typography variant=\"subtitle1\" color=\"textSecondary\">\r\n                                Sites Programmés\r\n                            </Typography>\r\n                        </Box>\r\n                    </Paper>\r\n                </Grid>\r\n            </Grid>\r\n        </Box>\r\n    );\r\n};\r\n\r\nexport default Dashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\LoginPage.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\MyLayout.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[351,354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[351,354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[356,359],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[356,359],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[810,813],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[810,813],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[976,979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[976,979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1094,1097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1094,1097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Layout, AppBar, UserMenu, Logout } from 'react-admin';\r\nimport { MenuItem, ListItemIcon, ListItemText } from '@mui/material';\r\nimport SettingsIcon from '@mui/icons-material/Settings';\r\nimport { Link } from 'react-router-dom';\r\nimport { forwardRef } from 'react';\r\n\r\n// Custom User Menu Item to link to Profile\r\nconst ProfileMenu = forwardRef<any, any>((props, ref) => {\r\n    return (\r\n        <MenuItem\r\n            component={Link}\r\n            to=\"/profile\"\r\n            ref={ref}\r\n            {...props}\r\n        >\r\n            <ListItemIcon>\r\n                <SettingsIcon fontSize=\"small\" />\r\n            </ListItemIcon>\r\n            <ListItemText>Mon Profil</ListItemText>\r\n        </MenuItem>\r\n    );\r\n});\r\n\r\n// Custom User Menu including Profile and default Logout\r\nconst MyUserMenu = (props: any) => (\r\n    <UserMenu {...props}>\r\n        <ProfileMenu />\r\n        <Logout />\r\n    </UserMenu>\r\n);\r\n\r\n// Custom AppBar using MyUserMenu\r\nconst MyAppBar = (props: any) => <AppBar {...props} userMenu={<MyUserMenu />} />;\r\n\r\n// Custom Layout using MyAppBar\r\nconst MyLayout = (props: any) => <Layout {...props} appBar={MyAppBar} />;\r\n\r\nexport default MyLayout;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\authProvider.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\components\\AgentPdf.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3397,3400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3397,3400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Page, Text, View, Document, StyleSheet, Image } from '@react-pdf/renderer';\r\nimport moment from 'moment';\r\n\r\nconst styles = StyleSheet.create({\r\n    page: {\r\n        flexDirection: 'column',\r\n        backgroundColor: '#FFFFFF',\r\n        padding: 30,\r\n        fontFamily: 'Helvetica'\r\n    },\r\n    badgePage: {\r\n        flexDirection: 'column',\r\n        backgroundColor: '#FFFFFF',\r\n        fontFamily: 'Helvetica'\r\n    },\r\n    badgeWrapper: {\r\n        width: '85.6mm',\r\n        height: '54mm',\r\n        border: '1px solid #ddd',\r\n        borderRadius: 8,\r\n        overflow: 'hidden',\r\n        margin: 10,\r\n        backgroundColor: '#fff',\r\n        position: 'relative'\r\n    },\r\n    badgeFront: {\r\n        width: '100%',\r\n        height: '100%',\r\n        flexDirection: 'row'\r\n    },\r\n    badgeBack: {\r\n        width: '100%',\r\n        height: '100%',\r\n        padding: 10,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        backgroundColor: '#fff'\r\n    },\r\n    badgeHeaderRed: {\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        width: '100%',\r\n        height: 12,\r\n        backgroundColor: '#CD1A20'\r\n    },\r\n    badgePhotoContainer: {\r\n        width: '35%',\r\n        padding: 8,\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        paddingTop: 20\r\n    },\r\n    badgePhoto: {\r\n        width: 60,\r\n        height: 70,\r\n        borderRadius: 4,\r\n        objectFit: 'cover',\r\n        border: '1px solid #ccc'\r\n    },\r\n    badgeInfoContainer: {\r\n        width: '65%',\r\n        padding: 8,\r\n        paddingTop: 20,\r\n        justifyContent: 'flex-start'\r\n    },\r\n    badgeName: {\r\n        fontSize: 11,\r\n        fontWeight: 'bold',\r\n        textTransform: 'uppercase',\r\n        marginBottom: 2\r\n    },\r\n    badgeFirstName: {\r\n        fontSize: 10,\r\n        marginBottom: 4\r\n    },\r\n    badgeLabel: {\r\n        fontSize: 6,\r\n        color: '#666',\r\n        textTransform: 'uppercase',\r\n        marginTop: 4\r\n    },\r\n    badgeValue: {\r\n        fontSize: 8,\r\n        fontWeight: 'bold',\r\n        color: '#000'\r\n    },\r\n    badgeValueRed: {\r\n        fontSize: 8,\r\n        fontWeight: 'bold',\r\n        color: '#CD1A20'\r\n    },\r\n    badgeBackText: {\r\n        fontSize: 7,\r\n        textAlign: 'center',\r\n        marginBottom: 4,\r\n        color: '#333'\r\n    },\r\n    badgeLegalTitle: {\r\n        fontSize: 8,\r\n        fontWeight: 'bold',\r\n        textAlign: 'center',\r\n        marginBottom: 2,\r\n        textTransform: 'uppercase'\r\n    },\r\n    badgeLegalSmall: {\r\n        fontSize: 5,\r\n        textAlign: 'center',\r\n        color: '#666',\r\n        marginTop: 5,\r\n        fontStyle: 'italic'\r\n    },\r\n    header: {\r\n        fontSize: 18,\r\n        marginBottom: 20,\r\n        textAlign: 'center',\r\n        color: '#CD1A20',\r\n        fontWeight: 'bold',\r\n        textTransform: 'uppercase'\r\n    },\r\n    section: {\r\n        margin: 10,\r\n        padding: 10,\r\n        borderBottom: '1px solid #eee'\r\n    },\r\n    sectionTitle: {\r\n        fontSize: 14,\r\n        fontWeight: 'bold',\r\n        marginBottom: 5,\r\n        color: '#333'\r\n    },\r\n    fieldLabel: {\r\n        fontSize: 10,\r\n        color: '#666',\r\n        width: 150\r\n    },\r\n    fieldValue: {\r\n        fontSize: 11,\r\n        color: '#000',\r\n        flex: 1\r\n    },\r\n    row: {\r\n        flexDirection: 'row',\r\n        marginBottom: 4\r\n    }\r\n});\r\n\r\ninterface AgentPdfProps {\r\n    agent: any;\r\n    photoBase64?: string | null;\r\n    logoBase64?: string | null;\r\n}\r\n\r\nexport const AgentBadgePdf = ({ agent, photoBase64, logoBase64 }: AgentPdfProps) => {\r\n    if (!agent) return <Document><Page><Text>No Data</Text></Page></Document>;\r\n\r\n    const photoSrc = photoBase64 || agent.photoURL;\r\n\r\n    return (\r\n        <Document>\r\n            <Page size=\"A4\" style={styles.badgePage}>\r\n\r\n                {/* RECTO (FRONT) */}\r\n                <View style={styles.badgeWrapper}>\r\n                    {logoBase64 && (\r\n                        <Image src={logoBase64} style={{\r\n                            position: 'absolute',\r\n                            top: '50%',\r\n                            left: '50%',\r\n                            transform: 'translate(-50%, -50%)',\r\n                            width: 140,\r\n                            height: 140,\r\n                            opacity: 0.08,\r\n                            zIndex: -1\r\n                        }} />\r\n                    )}\r\n\r\n                    <View style={styles.badgeHeaderRed} />\r\n                    <View style={styles.badgeFront}>\r\n                        <View style={styles.badgePhotoContainer}>\r\n                            {photoSrc ? (\r\n                                <Image src={photoSrc} style={styles.badgePhoto} />\r\n                            ) : (\r\n                                <View style={{ ...styles.badgePhoto, backgroundColor: '#eee' }} />\r\n                            )}\r\n                        </View>\r\n                        <View style={styles.badgeInfoContainer}>\r\n                            <Text style={styles.badgeName}>{agent.lastName}</Text>\r\n                            <Text style={styles.badgeFirstName}>{agent.firstName}</Text>\r\n\r\n                            <Text style={styles.badgeLabel}>Né(e) le</Text>\r\n                            <Text style={styles.badgeValue}>{agent.birthDate ? moment(agent.birthDate).format('DD/MM/YYYY') : 'N/A'}</Text>\r\n\r\n                            <Text style={styles.badgeLabel}>N° Carte Pro</Text>\r\n                            <Text style={styles.badgeValueRed}>{agent.professionalCardNumber || 'N/A'}</Text>\r\n\r\n                            <Text style={styles.badgeLabel}>Activités</Text>\r\n                            <Text style={styles.badgeValue} wrap={false}>\r\n                                {agent.specialties?.join(', ') || 'Surveillance Humaine'}\r\n                            </Text>\r\n\r\n                            {agent.specialties?.includes('CYNO') && agent.dogIds && (\r\n                                <>\r\n                                    <Text style={styles.badgeLabel}>Numéros Chiens</Text>\r\n                                    <Text style={{ ...styles.badgeValue, fontSize: 6 }}>{agent.dogIds}</Text>\r\n                                </>\r\n                            )}\r\n                        </View>\r\n                    </View>\r\n                </View>\r\n\r\n                {/* VERSO (BACK) */}\r\n                <View style={styles.badgeWrapper}>\r\n                    {logoBase64 && (\r\n                        <Image src={logoBase64} style={{\r\n                            position: 'absolute',\r\n                            top: '50%',\r\n                            left: '50%',\r\n                            transform: 'translate(-50%, -50%)',\r\n                            width: 140,\r\n                            height: 140,\r\n                            opacity: 0.15,\r\n                            zIndex: -1\r\n                        }} />\r\n                    )}\r\n\r\n                    <View style={styles.badgeBack}>\r\n                        <Text style={styles.badgeLegalTitle}>MO'CYNO - Agence de Sécurité Privée</Text>\r\n                        <Text style={styles.badgeBackText}>SASU au capital social de 1000€</Text>\r\n                        <Text style={styles.badgeBackText}>SIRET 990 179 566 00015 — NAF 80.10Z</Text>\r\n\r\n                        <Text style={{ ...styles.badgeBackText, marginTop: 5 }}>31 Rue Chevalier Paul</Text>\r\n                        <Text style={styles.badgeBackText}>83000 TOULON, FRANCE</Text>\r\n\r\n                        <Text style={{ ...styles.badgeBackText, marginTop: 10, fontWeight: 'bold' }}>\r\n                            Autorisation CNAPS : AUT-83-2124-09-09-20250998415\r\n                        </Text>\r\n\r\n                        <Text style={styles.badgeLegalSmall}>\r\n                            \"L'autorisation d'exercice ne confère aucune prérogative de puissance publique à l'entreprise ou aux personnes qui en bénéficient.\"\r\n                        </Text>\r\n                        <Text style={styles.badgeLegalSmall}>\r\n                            (Article 7 de la loi n° 83-629 du 12 juillet 1983)\r\n                        </Text>\r\n                    </View>\r\n                </View>\r\n\r\n            </Page>\r\n        </Document>\r\n    )\r\n};\r\n\r\nexport const AgentProfilePdf = ({ agent, photoBase64 }: AgentPdfProps) => (\r\n    <Document>\r\n        <Page size=\"A4\" style={styles.page}>\r\n            <Text style={styles.header}>Fiche de Renseignements Agent</Text>\r\n\r\n            <View style={{ flexDirection: 'row', marginBottom: 20 }}>\r\n                {(photoBase64 || agent.photoURL) ? (\r\n                    <Image src={photoBase64 || agent.photoURL} style={{ width: 100, height: 100, borderRadius: 5, marginRight: 20, objectFit: 'cover' }} />\r\n                ) : null}\r\n                <View>\r\n                    <Text style={{ fontSize: 20, fontWeight: 'bold' }}>{agent.firstName} {agent.lastName}</Text>\r\n                    <Text style={{ fontSize: 14, color: '#666' }}>{agent.role} - {agent.status}</Text>\r\n                    <Text style={{ fontSize: 12, marginTop: 5 }}>Matricule: {agent.matricule}</Text>\r\n                </View>\r\n            </View>\r\n\r\n            <View style={styles.section}>\r\n                <Text style={styles.sectionTitle}>État Civil</Text>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Date de Naissance:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.birthDate ? moment(agent.birthDate).format('DD/MM/YYYY') : '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Lieu de Naissance:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.birthPlace || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Nationalité:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.nationality || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Genre:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.gender || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Groupe Sanguin:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.bloodGroup || '-'}</Text>\r\n                </View>\r\n            </View>\r\n\r\n            <View style={styles.section}>\r\n                <Text style={styles.sectionTitle}>Coordonnées</Text>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Adresse:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.address || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Code Postal / Ville:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.zipCode || '-'} {agent.city || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Téléphone:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.phone || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Email:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.email}</Text>\r\n                </View>\r\n            </View>\r\n\r\n            <View style={styles.section}>\r\n                <Text style={styles.sectionTitle}>Infos Professionnelles</Text>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>N° Carte Pro:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.professionalCardNumber || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Obtention Carte Pro:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.professionalCardObtainedAt ? moment(agent.professionalCardObtainedAt).format('DD/MM/YYYY') : '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>N° SST:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.sstNumber || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Obtention SST:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.sstObtainedAt ? moment(agent.sstObtainedAt).format('DD/MM/YYYY') : '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Expiration SST:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.sstExpiresAt ? moment(agent.sstExpiresAt).format('DD/MM/YYYY') : '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Nature Contrat:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.contractNature || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Spécialités:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.specialties?.join(', ') || '-'}</Text>\r\n                </View>\r\n                {agent.dogIds && (\r\n                    <View style={styles.row}>\r\n                        <Text style={styles.fieldLabel}>Chiens (ID 250...):</Text>\r\n                        <Text style={styles.fieldValue}>{agent.dogIds}</Text>\r\n                    </View>\r\n                )}\r\n            </View>\r\n\r\n            <View style={styles.section}>\r\n                <Text style={styles.sectionTitle}>Administratif & Bancaire</Text>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>N° Sécurité Sociale:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.socialSecurityNumber || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>Banque:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.bankName || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>IBAN:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.iban || '-'}</Text>\r\n                </View>\r\n                <View style={styles.row}>\r\n                    <Text style={styles.fieldLabel}>BIC:</Text>\r\n                    <Text style={styles.fieldValue}>{agent.bic || '-'}</Text>\r\n                </View>\r\n            </View>\r\n\r\n        </Page>\r\n    </Document>\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\dataProvider.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[323,326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[323,326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_params' is defined but never used.","line":15,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":46},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[680,683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[680,683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[938,941],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[938,941],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[997,1000],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[997,1000],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1223,1226],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1223,1226],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1342,1345],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1342,1345],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1609,1612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1609,1612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_params' is defined but never used.","line":38,"column":48,"nodeType":null,"messageId":"unusedVar","endLine":38,"endColumn":55},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1679,1682],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1679,1682],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1895,1898],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1895,1898],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1954,1957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1954,1957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2386,2389],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2386,2389],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2445,2448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2445,2448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'id' is assigned a value but never used.","line":54,"column":17,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2922,2925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2922,2925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3076,3079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3076,3079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":73,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":73,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3139,3142],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3139,3142],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3353,3356],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3353,3356],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3412,3415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3412,3415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3570,3573],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3570,3573],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3633,3636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3633,3636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3834,3837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3834,3837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":23,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { DataProvider } from 'react-admin';\r\nimport { db, storage } from './firebase';\r\nimport { collection, getDocs, doc, getDoc, addDoc, updateDoc, deleteDoc } from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\n\r\nconst convertFileToUrl = async (_fileKey: string, file: any) => {\r\n    if (!file || !file.rawFile) return file;\r\n    const storageRef = ref(storage, `agents/photos/${file.rawFile.name}`);\r\n    await uploadBytes(storageRef, file.rawFile);\r\n    const downloadURL = await getDownloadURL(storageRef);\r\n    return downloadURL;\r\n}\r\n\r\nconst dataProvider: DataProvider = {\r\n    getList: async (resource: string, _params: any) => {\r\n        const querySnapshot = await getDocs(collection(db, resource));\r\n        const data = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n        return {\r\n            data: data,\r\n            total: data.length,\r\n        } as any;\r\n    },\r\n    getOne: async (resource: string, params: any) => {\r\n        const docRef = doc(db, resource, params.id.toString());\r\n        const docSnap = await getDoc(docRef);\r\n        if (docSnap.exists()) {\r\n            return { data: { id: docSnap.id, ...docSnap.data() } } as any;\r\n        }\r\n        throw new Error('Document not found');\r\n    },\r\n    getMany: async (resource: string, params: any) => {\r\n        const querySnapshot = await getDocs(collection(db, resource));\r\n        const data = querySnapshot.docs\r\n            .filter(doc => params.ids.includes(doc.id))\r\n            .map(doc => ({ id: doc.id, ...doc.data() }));\r\n        return { data } as any;\r\n    },\r\n    getManyReference: async (resource: string, _params: any) => {\r\n        const querySnapshot = await getDocs(collection(db, resource));\r\n        const data = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n        return { data, total: data.length } as any;\r\n    },\r\n    create: async (resource: string, params: any) => {\r\n        // Handle file upload for create if needed (though mostly manual currently)\r\n        const newItem = { ...params.data };\r\n        if (newItem.photoURL && newItem.photoURL.rawFile) {\r\n            newItem.photoURL = await convertFileToUrl('photoURL', newItem.photoURL);\r\n        }\r\n\r\n        const docRef = await addDoc(collection(db, resource), newItem);\r\n        return { data: { ...newItem, id: docRef.id } } as any;\r\n    },\r\n    update: async (resource: string, params: any) => {\r\n        const { id, ...rest } = params.data;\r\n\r\n        // Handle file upload\r\n        if (rest.photoURL && rest.photoURL.rawFile) {\r\n            rest.photoURL = await convertFileToUrl('photoURL', rest.photoURL);\r\n        }\r\n\r\n        // Remove undefined values\r\n        const data = Object.keys(rest).reduce((acc, key) => {\r\n            if (rest[key] !== undefined) {\r\n                acc[key] = rest[key];\r\n            }\r\n            return acc;\r\n        }, {} as any);\r\n\r\n        const docRef = doc(db, resource, params.id.toString());\r\n        await updateDoc(docRef, data);\r\n        return { data: params.data } as any;\r\n    },\r\n    updateMany: async (resource: string, params: any) => {\r\n        for (const id of params.ids) {\r\n            const docRef = doc(db, resource, id.toString());\r\n            await updateDoc(docRef, params.data);\r\n        }\r\n        return { data: params.ids } as any;\r\n    },\r\n    delete: async (resource: string, params: any) => {\r\n        const docRef = doc(db, resource, params.id.toString());\r\n        await deleteDoc(docRef);\r\n        return { data: params.previousData } as any;\r\n    },\r\n    deleteMany: async (resource: string, params: any) => {\r\n        for (const id of params.ids) {\r\n            const docRef = doc(db, resource, id.toString());\r\n            await deleteDoc(docRef);\r\n        }\r\n        return { data: params.ids } as any;\r\n    }\r\n};\r\n\r\nexport default dataProvider;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\firebase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\pages\\Agents.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1998,2001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1998,2001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":175,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7120,7123],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7120,7123],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":183,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7667,7670],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7667,7670],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":262,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":262,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11641,11644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11641,11644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":314,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":314,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14005,14008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14005,14008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":335,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14833,14836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14833,14836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport {\r\n    List, Datagrid, TextField, EmailField, DateField, Create, Edit, SimpleForm,\r\n    TextInput, required, useNotify, useRedirect, Title, SelectArrayInput,\r\n    FunctionField, SelectInput, TabbedForm, FormTab, DateInput, ImageField, ImageInput, TopToolbar,\r\n    FormDataConsumer, regex, useRefresh, useRecordContext\r\n} from 'react-admin';\r\nimport { getFunctions, httpsCallable } from 'firebase/functions';\r\nimport { PDFDownloadLink } from '@react-pdf/renderer';\r\nimport { AgentBadgePdf, AgentProfilePdf } from '../components/AgentPdf';\r\nimport { Button, CircularProgress } from '@mui/material';\r\nimport { Download as DownloadIcon, Autorenew as GenerateIcon } from '@mui/icons-material';\r\nimport { storage } from '../firebase';\r\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage';\r\nimport { imageUrlToPngBase64 } from '../utils/imageUtils';\r\n\r\n// Validation for Card Pro: CAR-083-2030-03-18-20250141086\r\nconst validateCardPro = (value: string) => {\r\n    if (!value) return undefined;\r\n    return undefined;\r\n};\r\n\r\n// Validation for Dog ID: 250 268 780 869 046 (15 digits usually displayed in groups)\r\n// Regex: 15 digits, allowing spaces\r\nconst validateDogId = regex(/^\\d{3}\\s?\\d{3}\\s?\\d{3}\\s?\\d{3}\\s?\\d{3}$/, 'Format requis: 250 268 780 869 046 (15 chiffres)');\r\n\r\nconst GenerateMatriculeButton = () => {\r\n    const record = useRecordContext();\r\n    const refresh = useRefresh();\r\n    const notify = useNotify();\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    if (!record || record.matricule) return null;\r\n\r\n    const handleGenerate = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const functions = getFunctions(undefined, 'europe-west1');\r\n            const generateMatricule = httpsCallable(functions, 'generateMatricule');\r\n            await generateMatricule({ agentId: record.id });\r\n            notify('Matricule généré avec succès');\r\n            refresh();\r\n        } catch (error: any) {\r\n            console.error(error);\r\n            notify(`Erreur: ${error.message}`, { type: 'error' });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Button\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            size=\"small\"\r\n            onClick={handleGenerate}\r\n            disabled={loading}\r\n            startIcon={<GenerateIcon />}\r\n            sx={{ mt: 2, mb: 2 }}\r\n        >\r\n            {loading ? 'Génération...' : 'Générer Matricule'}\r\n        </Button>\r\n    );\r\n};\r\n\r\nconst AgentDownloadButtons = () => {\r\n    const record = useRecordContext();\r\n    const [photoBase64, setPhotoBase64] = useState<string | null>(null);\r\n    const [logoBase64, setLogoBase64] = useState<string | null>(null);\r\n    const [loadingImages, setLoadingImages] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const loadImages = async () => {\r\n            if (!record) return;\r\n\r\n            // Avoid re-loading if already set\r\n            if (photoBase64 !== null && logoBase64 !== null) return;\r\n            if (loadingImages) return;\r\n\r\n            setLoadingImages(true);\r\n\r\n            // Safety timeout promise\r\n            const timeoutPromise = new Promise((_, reject) =>\r\n                setTimeout(() => reject(new Error('Image loading timed out')), 5000)\r\n            );\r\n\r\n            const loadProcess = async () => {\r\n                // 1. Load Agent Photo\r\n                let photoData = photoBase64;\r\n                if (record.photoURL && !photoData) {\r\n                    try {\r\n                        // Use the utility function which uses fetch (CORS now supported)\r\n                        // This avoids using getBlob which requires Buffer polyfill\r\n                        photoData = await imageUrlToPngBase64(record.photoURL);\r\n                        setPhotoBase64(photoData);\r\n                    } catch (err) {\r\n                        console.error(\"Failed to load agent photo:\", err);\r\n                        setPhotoBase64('');\r\n                    }\r\n                } else if (!photoData) {\r\n                    setPhotoBase64(''); // No URL, validly empty\r\n                }\r\n\r\n                // 2. Load Logo\r\n                let logoData = logoBase64;\r\n                if (!logoData) {\r\n                    try {\r\n                        logoData = await imageUrlToPngBase64('/mocyno-logo.png');\r\n                        setLogoBase64(logoData);\r\n                    } catch (err) {\r\n                        console.warn(\"Failed to load logo:\", err);\r\n                        setLogoBase64('');\r\n                    }\r\n                }\r\n            };\r\n\r\n            try {\r\n                // Race between loading and timeout\r\n                await Promise.race([loadProcess(), timeoutPromise]);\r\n            } catch (error) {\r\n                console.error(\"Error or timeout in loadImages:\", error);\r\n                // Ensure values are set to strings so UI unblocks\r\n                setPhotoBase64(prev => prev ?? '');\r\n                setLogoBase64(prev => prev ?? '');\r\n            } finally {\r\n                setLoadingImages(false);\r\n            }\r\n        };\r\n\r\n        loadImages();\r\n    }, [record, photoBase64, logoBase64, loadingImages]);\r\n\r\n    if (!record) return null;\r\n\r\n    const ready = !loadingImages && (logoBase64 !== null);\r\n\r\n    return (\r\n        <div style={{ display: 'flex', gap: 10 }}>\r\n            {ready ? (\r\n                <>\r\n                    <PDFDownloadLink\r\n                        document={<AgentBadgePdf agent={record} photoBase64={photoBase64} logoBase64={logoBase64} />}\r\n                        fileName={`Badge-${record.lastName || 'Agent'}.pdf`}\r\n                    >\r\n                        {({ loading }) => (\r\n                            <Button variant=\"contained\" color=\"primary\" startIcon={<DownloadIcon />} disabled={loading}>\r\n                                {loading ? <CircularProgress size={24} color=\"inherit\" /> : 'Badge Agent'}\r\n                            </Button>\r\n                        )}\r\n                    </PDFDownloadLink>\r\n\r\n                    <PDFDownloadLink\r\n                        document={<AgentProfilePdf agent={record} photoBase64={photoBase64} />}\r\n                        fileName={`Fiche-${record.lastName || 'Agent'}.pdf`}\r\n                    >\r\n                        {({ loading }) => (\r\n                            <Button variant=\"contained\" color=\"secondary\" startIcon={<DownloadIcon />} disabled={loading}>\r\n                                {loading ? <CircularProgress size={24} color=\"inherit\" /> : 'Fiche Renseignements'}\r\n                            </Button>\r\n                        )}\r\n                    </PDFDownloadLink>\r\n                </>\r\n            ) : (\r\n                <Button variant=\"contained\" disabled startIcon={<DownloadIcon />}>\r\n                    Chargement Images...\r\n                </Button>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport const AgentList = () => (\r\n    <List>\r\n        <Datagrid rowClick=\"edit\">\r\n            <FunctionField label=\"Photo\" render={(record: any) =>\r\n                record.photoURL ? <img src={record.photoURL} style={{ width: 40, height: 40, borderRadius: '50%', objectFit: 'cover' }} alt=\"\" /> : null\r\n            } />\r\n            <TextField source=\"matricule\" label=\"Matricule\" />\r\n            <TextField source=\"firstName\" label=\"Prénom\" />\r\n            <TextField source=\"lastName\" label=\"Nom\" />\r\n            <TextField source=\"professionalCardNumber\" label=\"Carte Pro\" />\r\n            <EmailField source=\"email\" />\r\n            <FunctionField label=\"Spécialités\" render={(record: any) => record.specialties ? record.specialties.join(', ') : ''} />\r\n            <TextField source=\"status\" />\r\n            <DateField source=\"createdAt\" label=\"Créé le\" />\r\n        </Datagrid>\r\n    </List>\r\n);\r\n\r\nconst UserEditActions = () => (\r\n    <TopToolbar>\r\n    </TopToolbar>\r\n);\r\n\r\nexport const AgentEdit = () => (\r\n    <Edit actions={<UserEditActions />}>\r\n        <Title title=\"Modifier l'Agent\" />\r\n        <TabbedForm>\r\n            <FormTab label=\"Identité\">\r\n                <TextInput source=\"id\" disabled />\r\n                <TextInput source=\"matricule\" disabled label=\"Matricule (Auto)\" />\r\n                <GenerateMatriculeButton />\r\n                <TextInput source=\"email\" disabled label=\"Email (Non modifiable)\" fullWidth />\r\n\r\n                <ImageInput source=\"photoURL\" label=\"Photo d'Identité\" accept={{ 'image/*': ['.png', '.jpg', '.jpeg'] }}>\r\n                    <ImageField source=\"src\" title=\"title\" />\r\n                </ImageInput>\r\n\r\n                <TextInput source=\"firstName\" label=\"Prénom\" validate={required()} fullWidth />\r\n                <TextInput source=\"lastName\" label=\"Nom\" validate={required()} fullWidth />\r\n\r\n                <DateInput source=\"birthDate\" label=\"Date de Naissance\" fullWidth />\r\n                <TextInput source=\"birthPlace\" label=\"Lieu de Naissance\" fullWidth />\r\n                <TextInput source=\"nationality\" label=\"Nationalité\" fullWidth />\r\n\r\n                <SelectInput source=\"gender\" label=\"Genre\" choices={[\r\n                    { id: 'M', name: 'Masculin' },\r\n                    { id: 'F', name: 'Féminin' },\r\n                ]} fullWidth />\r\n\r\n                <SelectInput source=\"bloodGroup\" label=\"Groupe Sanguin\" choices={[\r\n                    { id: 'A+', name: 'A+' }, { id: 'A-', name: 'A-' },\r\n                    { id: 'B+', name: 'B+' }, { id: 'B-', name: 'B-' },\r\n                    { id: 'AB+', name: 'AB+' }, { id: 'AB-', name: 'AB-' },\r\n                    { id: 'O+', name: 'O+' }, { id: 'O-', name: 'O-' },\r\n                ]} fullWidth />\r\n            </FormTab>\r\n\r\n            <FormTab label=\"Coordonnées\">\r\n                <TextInput source=\"address\" label=\"Adresse Postale\" fullWidth multiline />\r\n                <TextInput source=\"zipCode\" label=\"Code Postal\" fullWidth />\r\n                <TextInput source=\"city\" label=\"Ville\" fullWidth />\r\n                <TextInput source=\"phone\" label=\"Téléphone\" fullWidth />\r\n            </FormTab>\r\n\r\n            <FormTab label=\"Professionnel\">\r\n                <SelectArrayInput source=\"specialties\" label=\"Spécialités\" choices={[\r\n                    { id: 'ADS', name: 'Agent de Sécurité (ADS)' },\r\n                    { id: 'SSIAP1', name: 'SSIAP 1' },\r\n                    { id: 'SSIAP2', name: 'SSIAP 2' },\r\n                    { id: 'CYNO', name: 'Agent Cynophile' },\r\n                    { id: 'RONDIER', name: 'Rondier' },\r\n                    { id: 'VIDEO', name: 'Opérateur Vidéo' },\r\n                ]} fullWidth />\r\n\r\n                <FormDataConsumer>\r\n                    {({ formData, ...rest }) =>\r\n                        formData.specialties && formData.specialties.includes('CYNO') &&\r\n                        <TextInput\r\n                            source=\"dogIds\"\r\n                            label=\"Numéro(s) d'identification Chien (250...)\"\r\n                            validate={validateDogId}\r\n                            fullWidth\r\n                            helperText=\"15 chiffres (Ex: 250 268 780 869 046)\"\r\n                            {...rest}\r\n                        />\r\n                    }\r\n                </FormDataConsumer>\r\n\r\n                <TextInput source=\"professionalCardNumber\" label=\"Numéro de Carte Pro (Ex: CAR-083-2030-03-18-XXXXXXXXXXX)\" validate={validateCardPro} fullWidth />\r\n                <DateInput source=\"professionalCardObtainedAt\" label=\"Date d'Obtention Carte Pro\" fullWidth />\r\n                <FunctionField label=\"Date Validité (Calculée)\" render={(record: any) => {\r\n                    if (!record.professionalCardObtainedAt) return '-';\r\n                    const date = new Date(record.professionalCardObtainedAt);\r\n                    date.setFullYear(date.getFullYear() + 5);\r\n                    return date.toLocaleDateString();\r\n                }} />\r\n\r\n                <TextInput source=\"sstNumber\" label=\"Numéro SST\" fullWidth />\r\n                <DateInput source=\"sstObtainedAt\" label=\"Date Obtention SST\" fullWidth />\r\n                <DateInput source=\"sstExpiresAt\" label=\"Date Expiration SST\" fullWidth />\r\n\r\n                <SelectInput source=\"contractNature\" label=\"Nature du Contrat\" choices={[\r\n                    { id: 'CDI', name: 'CDI' },\r\n                    { id: 'CDD', name: 'CDD' },\r\n                    { id: 'SAISONNIER', name: 'Saisonnier' },\r\n                    { id: 'EXTRA', name: 'Extra / Vacation' },\r\n                    { id: 'INTERIM', name: 'Intérim' },\r\n                ]} fullWidth />\r\n\r\n                <SelectInput source=\"contractType\" label=\"Type de Contrat\" choices={[\r\n                    { id: 'FULL_TIME', name: 'Temps Plein (35h)' },\r\n                    { id: 'PART_TIME', name: 'Temps Partiel' },\r\n                ]} fullWidth />\r\n            </FormTab>\r\n\r\n            <FormTab label=\"Administratif & Documents\">\r\n                <TextInput source=\"socialSecurityNumber\" label=\"Numéro de Sécurité Sociale\" fullWidth />\r\n                <TextInput source=\"bankName\" label=\"Nom de la Banque\" fullWidth />\r\n                <TextInput source=\"iban\" label=\"IBAN\" fullWidth />\r\n                <TextInput source=\"bic\" label=\"BIC\" fullWidth />\r\n\r\n                <div style={{ marginTop: 20 }}>\r\n                    <h3>Téléchargements</h3>\r\n                    <AgentDownloadButtons />\r\n                </div>\r\n            </FormTab>\r\n\r\n            <FormTab label=\"Compte\">\r\n                <SelectInput source=\"status\" label=\"Statut Compte\" choices={[\r\n                    { id: 'active', name: 'Actif' },\r\n                    { id: 'inactive', name: 'Inactif' },\r\n                ]} defaultValue=\"active\" fullWidth />\r\n            </FormTab>\r\n        </TabbedForm>\r\n    </Edit>\r\n);\r\n\r\nexport const AgentCreate = () => {\r\n    const [, setLoading] = useState(false);\r\n    const notify = useNotify();\r\n    const redirect = useRedirect();\r\n\r\n    const save = async (data: any) => {\r\n        setLoading(true);\r\n        try {\r\n            // Handle Photo Upload Manually first\r\n            let photoUrl = null;\r\n            if (data.photoURL && data.photoURL.rawFile) {\r\n                const file = data.photoURL.rawFile;\r\n                const storageRef = ref(storage, `agents/photos/${file.name}`);\r\n                await uploadBytes(storageRef, file);\r\n                photoUrl = await getDownloadURL(storageRef);\r\n            }\r\n\r\n            const functions = getFunctions(undefined, 'europe-west1');\r\n            const createAgent = httpsCallable(functions, 'createAgent');\r\n\r\n            await createAgent({\r\n                ...data,\r\n                photoURL: photoUrl\r\n            });\r\n            notify('Agent créé avec succès');\r\n            redirect('/agents');\r\n        } catch (error: any) {\r\n            console.error(error);\r\n            notify(`Erreur: ${error.message}`, { type: 'error' });\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <Create>\r\n            <SimpleForm onSubmit={save}>\r\n                <TextInput source=\"firstName\" label=\"Prénom\" validate={required()} fullWidth />\r\n                <TextInput source=\"lastName\" label=\"Nom\" validate={required()} fullWidth />\r\n                <TextInput source=\"email\" label=\"Email\" validate={[required()]} fullWidth type=\"email\" />\r\n\r\n                <ImageInput source=\"photoURL\" label=\"Photo d'Identité\" accept={{ 'image/*': ['.png', '.jpg', '.jpeg'] }}>\r\n                    <ImageField source=\"src\" title=\"title\" />\r\n                </ImageInput>\r\n\r\n                <SelectArrayInput source=\"specialties\" label=\"Spécialités\" choices={[\r\n                    { id: 'ADS', name: 'Agent de Sécurité (ADS)' },\r\n                    { id: 'SSIAP1', name: 'SSIAP 1' },\r\n                    { id: 'SSIAP2', name: 'SSIAP 2' },\r\n                    { id: 'CYNO', name: 'Agent Cynophile' },\r\n                    { id: 'RONDIER', name: 'Rondier' },\r\n                    { id: 'VIDEO', name: 'Opérateur Vidéo' },\r\n                ]} fullWidth />\r\n            </SimpleForm>\r\n        </Create>\r\n    );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\pages\\Consignes.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\pages\\Events.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1034,1037],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1034,1037],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Datagrid, List, TextField, DateField, FunctionField, Show, SimpleShowLayout } from 'react-admin';\r\n\r\nexport const EventList = () => (\r\n    <List>\r\n        <Datagrid rowClick=\"show\">\r\n            <TextField source=\"type\" label=\"Type\" />\r\n            <TextField source=\"title\" label=\"Titre\" />\r\n            <TextField source=\"authorEmail\" label=\"Agent\" />\r\n            <DateField source=\"timestamp\" showTime label=\"Date\" />\r\n            <TextField source=\"status\" label=\"Statut\" />\r\n        </Datagrid>\r\n    </List>\r\n);\r\n\r\nexport const EventShow = () => (\r\n    <Show>\r\n        <SimpleShowLayout>\r\n            <TextField source=\"type\" variant=\"h6\" />\r\n            <TextField source=\"title\" variant=\"h4\" />\r\n            <DateField source=\"timestamp\" showTime />\r\n            <TextField source=\"authorEmail\" label=\"Auteur\" />\r\n            <TextField source=\"description\" style={{ marginTop: '20px', whiteSpace: 'pre-wrap' }} />\r\n\r\n            <FunctionField\r\n                label=\"Preuve Photo\"\r\n                render={(record: any) => {\r\n                    if (!record.photo) return null;\r\n                    return (\r\n                        <div style={{ marginTop: '20px' }}>\r\n                            <img src={record.photo} alt=\"Preuve\" style={{ maxWidth: '500px', borderRadius: '4px' }} />\r\n                        </div>\r\n                    );\r\n                }}\r\n            />\r\n        </SimpleShowLayout>\r\n    </Show>\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\pages\\Payroll.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Do not use \"@ts-nocheck\" because it alters compilation errors.","line":1,"column":1,"nodeType":"Line","messageId":"tsDirectiveComment","endLine":1,"endColumn":15},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":11,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":11,"endColumn":14,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[572,585],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'calculateDuration' is defined but never used.","line":14,"column":34,"nodeType":null,"messageId":"unusedVar","endLine":14,"endColumn":51},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Mission' is defined but never used.","line":15,"column":15,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":22},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1441,1444],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1441,1444],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1603,1606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1603,1606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1943,1946],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1943,1946],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2013,2016],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2013,2016],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2057,2060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2057,2060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2425,2428],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2425,2428],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2548,2551],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2548,2551],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2721,2724],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2721,2724],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":103,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":106,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4990,4993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4990,4993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":13,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\r\nimport { useMemo, useState } from 'react';\r\nimport { Button, Grid, Typography, Box, Paper, Avatar, Divider, Chip, CircularProgress } from '@mui/material';\r\nimport { Title, useGetList, Loading, useNotify } from 'react-admin';\r\nimport DownloadIcon from '@mui/icons-material/Download';\r\nimport NightlightRoundIcon from '@mui/icons-material/NightlightRound';\r\nimport CalendarTodayIcon from '@mui/icons-material/CalendarToday';\r\nimport StarIcon from '@mui/icons-material/Star';\r\nimport EmailIcon from '@mui/icons-material/Email';\r\nimport moment from 'moment';\r\n// @ts-ignore\r\nimport 'moment/dist/locale/fr';\r\nimport { getFunctions, httpsCallable } from 'firebase/functions';\r\nimport { calculateVacationStats, calculateDuration } from '../utils/planningUtils';\r\nimport type { Mission } from '../types/models';\r\n\r\nmoment.locale('fr');\r\n\r\nconst Payroll = () => {\r\n    const { data: agents, isLoading: loadingAgents } = useGetList('agents');\r\n    const { data: planning, isLoading: loadingPlanning } = useGetList('planning');\r\n    const notify = useNotify();\r\n    const [sendingEmail, setSendingEmail] = useState<string | null>(null);\r\n\r\n    const handleSendPlanning = async (agentId: string) => {\r\n        setSendingEmail(agentId);\r\n        try {\r\n            const functions = getFunctions(undefined, 'europe-west1');\r\n            const sendSummary = httpsCallable(functions, 'sendAgentPlanningSummary');\r\n            const result: any = await sendSummary({ agentId });\r\n\r\n            notify(result.data.message || 'Planning renvoyé avec succès', { type: 'success' });\r\n        } catch (error: any) {\r\n            console.error(\"Error sending planning:\", error);\r\n            notify(`Erreur: ${error.message}`, { type: 'error' });\r\n        } finally {\r\n            setSendingEmail(null);\r\n        }\r\n    };\r\n\r\n    const stats = useMemo(() => {\r\n        if (!agents || !planning) return [];\r\n\r\n        const agentStats: Record<string, any> = {};\r\n\r\n        // Initialize agents\r\n        agents.filter((a: any) => a.role !== 'admin').forEach((agent: any) => {\r\n            agentStats[agent.id] = {\r\n                agent,\r\n                totalPlanned: 0,\r\n                totalDone: 0,\r\n                nightHours: 0,\r\n                sundayHours: 0,\r\n                holidayHours: 0,\r\n                futureHours: 0\r\n            };\r\n        });\r\n\r\n        const now = moment();\r\n\r\n        planning.forEach((mission: any) => {\r\n            if (!mission.agentAssignments) return;\r\n\r\n            mission.agentAssignments.forEach((assignment: any) => {\r\n                const agentId = assignment.agentId;\r\n                if (!agentStats[agentId]) return;\r\n\r\n                assignment.vacations.forEach((vacation: any) => {\r\n                    const start = moment(`${vacation.date}T${vacation.start}`);\r\n                    const end = moment(`${vacation.date}T${vacation.end}`);\r\n\r\n                    // Handle overnight shifts (end is next day)\r\n                    if (end.isBefore(start)) {\r\n                        end.add(1, 'day');\r\n                    }\r\n\r\n                    const isDone = end.isBefore(now);\r\n\r\n                    // Use shared utility for rigorous calculation\r\n                    const vacationStats = calculateVacationStats(start, end);\r\n\r\n                    // For totalDone/Planned, we can use the stats.total from shared util\r\n                    if (isDone) {\r\n                        agentStats[agentId].totalDone += vacationStats.total;\r\n                    } else {\r\n                        agentStats[agentId].futureHours += vacationStats.total;\r\n                    }\r\n                    agentStats[agentId].totalPlanned += vacationStats.total;\r\n\r\n                    // Details from shared util\r\n                    agentStats[agentId].nightHours += vacationStats.night;\r\n                    agentStats[agentId].sundayHours += vacationStats.sunday;\r\n                    agentStats[agentId].holidayHours += vacationStats.holiday;\r\n                });\r\n            });\r\n        });\r\n\r\n        return Object.values(agentStats);\r\n    }, [agents, planning]);\r\n\r\n    if (loadingAgents || loadingPlanning) return <Loading />;\r\n\r\n    return (\r\n        <Box>\r\n            <Title title=\"RH & Paie\" />\r\n\r\n            <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\" mb={3}>\r\n                <Typography variant=\"h4\" sx={{ color: '#1a1a1a', fontWeight: 'bold' }}>\r\n                    Suivi des Heures Agents\r\n                </Typography>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    startIcon={<DownloadIcon />}\r\n                    onClick={() => alert(\"csv export todo\")}\r\n                    sx={{ backgroundColor: '#CD1A20' }}\r\n                >\r\n                    Export Global CSV\r\n                </Button>\r\n            </Box>\r\n\r\n            <Grid container spacing={3}>\r\n                {stats.map(({ agent, totalDone, futureHours, nightHours, sundayHours, holidayHours }: any) => (\r\n                    <Grid item xs={12} md={6} lg={4} key={agent.id}>\r\n                        <Paper elevation={2} sx={{ p: 3, borderRadius: 2, height: '100%' }}>\r\n                            <Box display=\"flex\" alignItems=\"center\" mb={2}>\r\n                                <Avatar sx={{ bgcolor: '#CD1A20', mr: 2 }}>\r\n                                    {agent.firstName?.[0]}{agent.lastName?.[0]}\r\n                                </Avatar>\r\n                                <Box>\r\n                                    <Typography variant=\"h6\">\r\n                                        {agent.firstName} {agent.lastName}\r\n                                    </Typography>\r\n                                    <Typography variant=\"body2\" color=\"textSecondary\">\r\n                                        {agent.email}\r\n                                    </Typography>\r\n                                </Box>\r\n                                <Chip\r\n                                    label={agent.status === 'active' ? 'Actif' : 'Inactif'}\r\n                                    color={agent.status === 'active' ? 'success' : 'default'}\r\n                                    size=\"small\"\r\n                                    sx={{ ml: 'auto' }}\r\n                                />\r\n                            </Box>\r\n\r\n                            <Divider sx={{ my: 2 }} />\r\n\r\n                            <Grid container spacing={2}>\r\n                                { /* Total & Done */}\r\n                                <Grid item xs={6}>\r\n                                    <Box sx={{ p: 1.5, bgcolor: '#f5f5f5', borderRadius: 1, textAlign: 'center' }}>\r\n                                        <Typography variant=\"caption\" color=\"textSecondary\">Effectuées</Typography>\r\n                                        <Typography variant=\"h5\" color=\"success.main\" fontWeight=\"bold\">\r\n                                            {totalDone.toFixed(1)}h\r\n                                        </Typography>\r\n                                    </Box>\r\n                                </Grid>\r\n                                <Grid item xs={6}>\r\n                                    <Box sx={{ p: 1.5, bgcolor: '#f5f5f5', borderRadius: 1, textAlign: 'center' }}>\r\n                                        <Typography variant=\"caption\" color=\"textSecondary\">Planifiées (Futur)</Typography>\r\n                                        <Typography variant=\"h5\" color=\"primary.main\" fontWeight=\"bold\">\r\n                                            {futureHours.toFixed(1)}h\r\n                                        </Typography>\r\n                                    </Box>\r\n                                </Grid>\r\n\r\n                                { /* Details */}\r\n                                <Grid item xs={12}>\r\n                                    <Typography variant=\"subtitle2\" sx={{ mt: 1, mb: 1, fontWeight: 'bold' }}>\r\n                                        Majorations & Détails\r\n                                    </Typography>\r\n                                </Grid>\r\n\r\n                                <Grid item xs={4}>\r\n                                    <Box display=\"flex\" flexDirection=\"column\" alignItems=\"center\">\r\n                                        <NightlightRoundIcon color=\"action\" fontSize=\"small\" />\r\n                                        <Typography variant=\"caption\" mt={0.5}>Nuit</Typography>\r\n                                        <Typography fontWeight=\"bold\">{nightHours.toFixed(1)}h</Typography>\r\n                                    </Box>\r\n                                </Grid>\r\n                                <Grid item xs={4}>\r\n                                    <Box display=\"flex\" flexDirection=\"column\" alignItems=\"center\">\r\n                                        <CalendarTodayIcon color=\"action\" fontSize=\"small\" />\r\n                                        <Typography variant=\"caption\" mt={0.5}>Dimanche</Typography>\r\n                                        <Typography fontWeight=\"bold\">{sundayHours.toFixed(1)}h</Typography>\r\n                                    </Box>\r\n                                </Grid>\r\n                                <Grid item xs={4}>\r\n                                    <Box display=\"flex\" flexDirection=\"column\" alignItems=\"center\">\r\n                                        <StarIcon color=\"action\" fontSize=\"small\" />\r\n                                        <Typography variant=\"caption\" mt={0.5}>Férié</Typography>\r\n                                        <Typography fontWeight=\"bold\">{holidayHours.toFixed(1)}h</Typography>\r\n                                    </Box>\r\n                                </Grid>\r\n\r\n                                <Grid item xs={12} sx={{ mt: 2 }}>\r\n                                    <Button\r\n                                        fullWidth\r\n                                        variant=\"outlined\"\r\n                                        color=\"primary\"\r\n                                        startIcon={sendingEmail === agent.id ? <CircularProgress size={20} /> : <EmailIcon />}\r\n                                        onClick={() => handleSendPlanning(agent.id)}\r\n                                        disabled={!!sendingEmail}\r\n                                    >\r\n                                        {sendingEmail === agent.id ? \"Envoi...\" : \"Renvoyer Planning\"}\r\n                                    </Button>\r\n                                </Grid>\r\n                            </Grid>\r\n                        </Paper>\r\n                    </Grid>\r\n                ))}\r\n            </Grid>\r\n        </Box>\r\n    );\r\n};\r\n\r\nexport default Payroll;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\pages\\Planning.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":5,"column":1,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":5,"endColumn":14,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[224,237],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1137,1140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1137,1140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1151,1154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1151,1154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1163,1166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1163,1166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1310,1313],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1310,1313],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1324,1327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1324,1327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1336,1339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1336,1339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":89,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":89,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3419,3422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3419,3422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":92,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":92,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3544,3547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3544,3547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":93,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3626,3629],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3626,3629],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5089,5092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5089,5092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":155,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":155,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5567,5570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5567,5570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":162,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":162,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5830,5833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5830,5833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5904,5907],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5904,5907],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":170,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6064,6067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6064,6067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6168,6171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6168,6171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6184,6187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6184,6187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":174,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":174,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6197,6200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6197,6200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":203,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7144,7147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7144,7147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":246,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8922,8925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8922,8925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":263,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":263,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9717,9720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9717,9720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":267,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":267,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9954,9957],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9954,9957],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":269,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10102,10105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10102,10105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":296,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11248,11251],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11248,11251],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":311,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11772,11775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11772,11775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":318,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":318,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12039,12042],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12039,12042],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":323,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":323,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12236,12239],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12236,12239],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":329,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12444,12447],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12444,12447],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":348,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":348,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13093,13096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13093,13096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":414,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":414,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15996,15999],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15996,15999],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":416,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":416,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16187,16190],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16187,16190],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":422,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":422,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16501,16504],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16501,16504],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":446,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":446,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18059,18062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18059,18062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":449,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":449,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18322,18325],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18322,18325],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":450,"column":119,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":450,"endColumn":122,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18464,18467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18464,18467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":472,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":472,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19949,19952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19949,19952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":476,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":476,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20200,20203],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20200,20203],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":477,"column":108,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":477,"endColumn":111,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20318,20321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20318,20321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":531,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":531,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23022,23025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23022,23025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":581,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":581,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26044,26047],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26044,26047],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":40,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback } from 'react';\r\nimport { Calendar, momentLocalizer, Views } from 'react-big-calendar';\r\nimport withDragAndDrop from 'react-big-calendar/lib/addons/dragAndDrop';\r\nimport moment from 'moment';\r\n// @ts-ignore\r\nimport 'moment/dist/locale/fr'; // Import French locale\r\nimport 'react-big-calendar/lib/css/react-big-calendar.css';\r\nimport 'react-big-calendar/lib/addons/dragAndDrop/styles.css';\r\nimport { Card, CardContent, CardHeader, Dialog, DialogTitle, DialogContent, DialogActions, Button, TextField, MenuItem, IconButton, Typography, Box, Tabs, Tab } from '@mui/material';\r\nimport { Add as AddIcon, Delete as DeleteIcon, PersonAdd as PersonAddIcon } from '@mui/icons-material';\r\nimport { Title, useGetList, useCreate, useUpdate, Loading, useNotify, List, Datagrid, TextField as RaTextField, FunctionField, DeleteButton } from 'react-admin';\r\n\r\n// Localizer setup\r\nmoment.locale('fr');\r\nconst localizer = momentLocalizer(moment);\r\nconst DnDCalendar = withDragAndDrop(Calendar);\r\n\r\n// Custom formats for 24h time\r\nconst formats = {\r\n    timeGutterFormat: 'HH:mm',\r\n    eventTimeRangeFormat: ({ start, end }: any, culture: any, local: any) =>\r\n        `${local.format(start, 'HH:mm', culture)} - ${local.format(end, 'HH:mm', culture)}`,\r\n    agendaTimeRangeFormat: ({ start, end }: any, culture: any, local: any) =>\r\n        `${local.format(start, 'HH:mm', culture)} - ${local.format(end, 'HH:mm', culture)}`,\r\n    dayHeaderFormat: 'dddd DD MMMM'\r\n};\r\n\r\ninterface Vacation {\r\n    date: string;\r\n    start: string;\r\n    end: string;\r\n}\r\n\r\ninterface AgentAssignment {\r\n    agentId: string;\r\n    agentName: string;\r\n    specialty: string;\r\n    vacations: Vacation[];\r\n}\r\n\r\nconst Planning = () => {\r\n    const { data: events, isLoading } = useGetList('planning');\r\n    const { data: sites } = useGetList('sites');\r\n    const { data: agents } = useGetList('agents');\r\n    const [create] = useCreate();\r\n    const [update] = useUpdate();\r\n    const notify = useNotify();\r\n\r\n    // Dialog State\r\n    const [openDialog, setOpenDialog] = useState(false);\r\n    const [editMode, setEditMode] = useState(false);\r\n    const [selectedMissionId, setSelectedMissionId] = useState<string | null>(null);\r\n\r\n    // Form Data\r\n    const [missionData, setMissionData] = useState({\r\n        siteId: '',\r\n        notes: ''\r\n    });\r\n    const [agentAssignments, setAgentAssignments] = useState<AgentAssignment[]>([{\r\n        agentId: '',\r\n        agentName: '',\r\n        specialty: '',\r\n        vacations: [{\r\n            date: moment().format('YYYY-MM-DD'),\r\n            start: '08:00',\r\n            end: '16:00'\r\n        }]\r\n    }]);\r\n\r\n    const [tabValue, setTabValue] = useState(0);\r\n\r\n    const handleTabChange = (_event: React.SyntheticEvent, newValue: number) => {\r\n        setTabValue(newValue);\r\n    };\r\n\r\n    // Helper to calculate start and end dates handling cross-day shifts\r\n    const getEventRange = (date: string, startStr: string, endStr: string) => {\r\n        const start = new Date(`${date}T${startStr}`);\r\n        let end = new Date(`${date}T${endStr}`);\r\n\r\n        // If end time is earlier than start time, it means it ends the next day\r\n        if (end < start) {\r\n            end = new Date(end.getTime() + 24 * 60 * 60 * 1000);\r\n        }\r\n        return { start, end };\r\n    };\r\n\r\n    // Transform missions to calendar events\r\n    const calendarEvents = (events || []).flatMap((mission: any) => {\r\n        if (!mission.agentAssignments) return [];\r\n\r\n        return mission.agentAssignments.flatMap((assignment: any, assignmentIdx: number) => {\r\n            return assignment.vacations.map((v: any, vacIdx: number) => {\r\n                const { start, end } = getEventRange(v.date, v.start, v.end);\r\n                return {\r\n                    id: `${mission.id}-${assignmentIdx}-${vacIdx}`,\r\n                    missionId: mission.id,\r\n                    start,\r\n                    end,\r\n                    title: `${mission.siteName} - ${assignment.agentName} (${assignment.specialty})`,\r\n                    resource: { mission, assignment, vacation: v }\r\n                };\r\n            });\r\n        });\r\n    });\r\n\r\n    const onEventResize = useCallback(\r\n        () => {\r\n            notify('Modification via drag non implémentée pour le nouveau modèle', { type: 'info' });\r\n        },\r\n        [notify]\r\n    );\r\n\r\n    const onEventDrop = useCallback(\r\n        () => {\r\n            notify('Modification via drag non implémentée pour le nouveau modèle', { type: 'info' });\r\n        },\r\n        [notify]\r\n    );\r\n\r\n    const resetForm = () => {\r\n        setMissionData({\r\n            siteId: '',\r\n            notes: ''\r\n        });\r\n        setAgentAssignments([{\r\n            agentId: '',\r\n            agentName: '',\r\n            specialty: '',\r\n            vacations: [{\r\n                date: moment().format('YYYY-MM-DD'),\r\n                start: '08:00',\r\n                end: '16:00'\r\n            }]\r\n        }]);\r\n        setEditMode(false);\r\n        setSelectedMissionId(null);\r\n    };\r\n\r\n    const handleSelectSlot = useCallback((slotInfo: any) => {\r\n        resetForm();\r\n        setAgentAssignments([{\r\n            agentId: '',\r\n            agentName: '',\r\n            specialty: '',\r\n            vacations: [{\r\n                date: moment(slotInfo.start).format('YYYY-MM-DD'),\r\n                start: moment(slotInfo.start).format('HH:mm'),\r\n                end: moment(slotInfo.end).format('HH:mm')\r\n            }]\r\n        }]);\r\n        setOpenDialog(true);\r\n    }, []);\r\n\r\n    const handleEditClick = (mission: any) => {\r\n        setEditMode(true);\r\n        setSelectedMissionId(mission.id);\r\n        setMissionData({\r\n            siteId: mission.siteId,\r\n            notes: mission.notes || ''\r\n        });\r\n        const assignmentsCopy = mission.agentAssignments.map((a: any) => ({\r\n            ...a,\r\n            vacations: a.vacations.map((v: any) => ({ ...v }))\r\n        }));\r\n        setAgentAssignments(assignmentsCopy);\r\n        setOpenDialog(true);\r\n    };\r\n\r\n    const handleSelectEvent = (event: any) => {\r\n        handleEditClick(event.resource.mission);\r\n    };\r\n\r\n    const handleRowClick = (_id: any, _resource: any, record: any): false => {\r\n        handleEditClick(record);\r\n        return false;\r\n    };\r\n\r\n    const handleCloseDialog = () => {\r\n        setOpenDialog(false);\r\n        resetForm();\r\n    };\r\n\r\n    const handleAddAgent = () => {\r\n        const lastAssignment = agentAssignments[agentAssignments.length - 1];\r\n        setAgentAssignments([...agentAssignments, {\r\n            agentId: '',\r\n            agentName: '',\r\n            specialty: '',\r\n            vacations: lastAssignment.vacations.map(v => ({ ...v }))\r\n        }]);\r\n    };\r\n\r\n    const handleRemoveAgent = (index: number) => {\r\n        if (agentAssignments.length > 1) {\r\n            setAgentAssignments(agentAssignments.filter((_, i) => i !== index));\r\n        }\r\n    };\r\n\r\n    const handleAgentChange = (assignmentIdx: number, field: string, value: string) => {\r\n        const updated = [...agentAssignments];\r\n        if (field === 'agentId') {\r\n            const agent = agents?.find((a: any) => a.id === value);\r\n            updated[assignmentIdx] = {\r\n                ...updated[assignmentIdx],\r\n                agentId: value,\r\n                agentName: agent ? `${agent.firstName} ${agent.lastName}` : ''\r\n            };\r\n        } else {\r\n            updated[assignmentIdx] = { ...updated[assignmentIdx], [field]: value };\r\n        }\r\n        setAgentAssignments(updated);\r\n    };\r\n\r\n    const handleAddVacation = (assignmentIdx: number) => {\r\n        const updated = [...agentAssignments];\r\n        const lastVacation = updated[assignmentIdx].vacations[updated[assignmentIdx].vacations.length - 1];\r\n        const nextDate = moment(lastVacation.date).add(1, 'day').format('YYYY-MM-DD');\r\n        updated[assignmentIdx].vacations.push({\r\n            date: nextDate,\r\n            start: lastVacation.start,\r\n            end: lastVacation.end\r\n        });\r\n        setAgentAssignments(updated);\r\n    };\r\n\r\n    const handleRemoveVacation = (assignmentIdx: number, vacationIdx: number) => {\r\n        const updated = [...agentAssignments];\r\n        if (updated[assignmentIdx].vacations.length > 1) {\r\n            updated[assignmentIdx].vacations = updated[assignmentIdx].vacations.filter((_, i) => i !== vacationIdx);\r\n            setAgentAssignments(updated);\r\n        }\r\n    };\r\n\r\n    const handleVacationChange = (assignmentIdx: number, vacationIdx: number, field: keyof Vacation, value: string) => {\r\n        const updated = [...agentAssignments];\r\n        updated[assignmentIdx].vacations[vacationIdx] = {\r\n            ...updated[assignmentIdx].vacations[vacationIdx],\r\n            [field]: value\r\n        };\r\n        setAgentAssignments(updated);\r\n    };\r\n\r\n    const handleSaveMission = async () => {\r\n        try {\r\n            const site = sites?.find((s: any) => s.id === missionData.siteId);\r\n            if (!site) {\r\n                notify('Site introuvable', { type: 'error' });\r\n                return;\r\n            }\r\n\r\n            for (const assignment of agentAssignments) {\r\n                if (!assignment.agentId || !assignment.specialty) {\r\n                    notify('Tous les agents doivent être sélectionnés avec une spécialité', { type: 'error' });\r\n                    return;\r\n                }\r\n            }\r\n\r\n            for (const assignment of agentAssignments) {\r\n                for (const vacation of assignment.vacations) {\r\n                    const { start: vacationStart, end: vacationEnd } = getEventRange(vacation.date, vacation.start, vacation.end);\r\n\r\n                    const hasConflict = events?.some((mission: any) => {\r\n                        if (editMode && mission.id === selectedMissionId) return false;\r\n\r\n                        if (!mission.agentAssignments) return false;\r\n                        return mission.agentAssignments.some((a: any) => {\r\n                            if (a.agentId !== assignment.agentId) return false;\r\n                            return a.vacations.some((v: any) => {\r\n                                const { start: eventStart, end: eventEnd } = getEventRange(v.date, v.start, v.end);\r\n                                return (vacationStart < eventEnd && vacationEnd > eventStart);\r\n                            });\r\n                        });\r\n                    });\r\n\r\n                    if (hasConflict) {\r\n                        notify(`Conflit détecté pour ${assignment.agentName} le ${vacation.date}`, { type: 'warning' });\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n\r\n            const payloadData = {\r\n                siteId: missionData.siteId,\r\n                siteName: site.name,\r\n                agentAssignments: agentAssignments,\r\n                assignedAgentIds: agentAssignments.map(a => a.agentId),\r\n                notes: missionData.notes || '',\r\n                updatedAt: new Date()\r\n            };\r\n\r\n            if (editMode && selectedMissionId) {\r\n                await update('planning', {\r\n                    id: selectedMissionId,\r\n                    data: payloadData,\r\n                    previousData: events?.find((e: any) => e.id === selectedMissionId)\r\n                });\r\n                notify('Mission mise à jour avec succès !');\r\n            } else {\r\n                await create('planning', {\r\n                    data: {\r\n                        ...payloadData,\r\n                        status: 'scheduled',\r\n                        createdAt: new Date()\r\n                    }\r\n                });\r\n                notify('Mission créée avec succès !');\r\n            }\r\n\r\n            handleCloseDialog();\r\n        } catch (error: any) {\r\n            notify(`Erreur: ${error.message}`, { type: 'error' });\r\n        }\r\n    };\r\n\r\n    const getAgentsForAssignment = (specialty: string | null) => {\r\n        if (!missionData.siteId || !sites || !agents) return [];\r\n        const site = sites.find((s: any) => s.id === missionData.siteId);\r\n\r\n        let potentialAgents = agents;\r\n\r\n        if (site?.requiredSpecialties?.length > 0) {\r\n            potentialAgents = potentialAgents.filter((agent: any) =>\r\n                agent.specialties?.some((s: string) => site.requiredSpecialties.includes(s))\r\n            );\r\n        }\r\n\r\n        if (specialty) {\r\n            return potentialAgents.filter((agent: any) =>\r\n                agent.specialties?.includes(specialty)\r\n            );\r\n        }\r\n\r\n        return potentialAgents;\r\n    };\r\n\r\n    const getApplicableSpecialties = () => {\r\n        const allSpecialties = [\r\n            { id: 'ADS', name: 'Agent de Sécurité (ADS)' },\r\n            { id: 'SSIAP1', name: 'SSIAP 1' },\r\n            { id: 'SSIAP2', name: 'SSIAP 2' },\r\n            { id: 'CYNO', name: 'Agent Cynophile' },\r\n            { id: 'RONDIER', name: 'Rondier' },\r\n            { id: 'VIDEO', name: 'Opérateur Vidéo' },\r\n        ];\r\n\r\n        if (!missionData.siteId || !sites) return allSpecialties;\r\n        const site = sites.find((s: any) => s.id === missionData.siteId);\r\n\r\n        if (site?.requiredSpecialties?.length > 0) {\r\n            return allSpecialties.filter(s => site.requiredSpecialties.includes(s.id));\r\n        }\r\n\r\n        return allSpecialties;\r\n    };\r\n\r\n    if (isLoading) return <Loading />;\r\n\r\n    return (\r\n        <Card>\r\n            <Title title=\"Planning Mo'Cyno\" />\r\n            <CardHeader\r\n                title=\"Gestion des Missions\"\r\n                action={\r\n                    <Button variant=\"contained\" color=\"primary\" onClick={() => { resetForm(); setOpenDialog(true); }}>\r\n                        Créer une Mission\r\n                    </Button>\r\n                }\r\n            />\r\n            <CardContent>\r\n                <Box sx={{ borderBottom: 1, borderColor: 'divider', mb: 2 }}>\r\n                    <Tabs value={tabValue} onChange={handleTabChange} aria-label=\"planning views\">\r\n                        <Tab label=\"Vue Calendrier\" />\r\n                        <Tab label=\"Liste des Missions\" />\r\n                    </Tabs>\r\n                </Box>\r\n\r\n                <div role=\"tabpanel\" hidden={tabValue !== 0}>\r\n                    {tabValue === 0 && (\r\n                        <div style={{ height: '80vh' }}>\r\n                            <DnDCalendar\r\n                                defaultView={Views.WEEK}\r\n                                events={calendarEvents}\r\n                                localizer={localizer}\r\n                                formats={formats}\r\n                                onEventDrop={onEventDrop}\r\n                                onEventResize={onEventResize}\r\n                                onSelectSlot={handleSelectSlot}\r\n                                onSelectEvent={handleSelectEvent}\r\n                                selectable\r\n                                resizable\r\n                                style={{ height: '100%' }}\r\n                                messages={{\r\n                                    next: \"Suivant\",\r\n                                    previous: \"Précédent\",\r\n                                    today: \"Aujourd'hui\",\r\n                                    month: \"Mois\",\r\n                                    week: \"Semaine\",\r\n                                    day: \"Jour\"\r\n                                }}\r\n                            />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div role=\"tabpanel\" hidden={tabValue !== 1}>\r\n                    {tabValue === 1 && (\r\n                        <List actions={false} title=\" \">\r\n                            <Datagrid bulkActionButtons={false} rowClick={handleRowClick}>\r\n                                <RaTextField source=\"siteName\" label=\"Site\" />\r\n\r\n                                <FunctionField\r\n                                    label=\"Période\"\r\n                                    render={(record: any) => {\r\n                                        if (!record.agentAssignments) return '-';\r\n                                        const allVacations = record.agentAssignments.flatMap((a: any) => a.vacations);\r\n                                        if (allVacations.length === 0) return '-';\r\n\r\n                                        const starts: number[] = [];\r\n                                        const ends: number[] = [];\r\n\r\n                                        allVacations.forEach((v: any) => {\r\n                                            const { start, end } = getEventRange(v.date, v.start, v.end);\r\n                                            starts.push(start.getTime());\r\n                                            ends.push(end.getTime());\r\n                                        });\r\n\r\n                                        const minStart = new Date(Math.min(...starts));\r\n                                        const maxEnd = new Date(Math.max(...ends));\r\n\r\n                                        return (\r\n                                            <Box>\r\n                                                <Typography variant=\"body2\" component=\"div\">\r\n                                                    Du {minStart.toLocaleDateString()} {minStart.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                                </Typography>\r\n                                                <Typography variant=\"body2\" component=\"div\">\r\n                                                    Au {maxEnd.toLocaleDateString()} {maxEnd.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\r\n                                                </Typography>\r\n                                            </Box>\r\n                                        );\r\n                                    }}\r\n                                />\r\n\r\n                                <FunctionField\r\n                                    label=\"Agents & Heures\"\r\n                                    render={(record: any) => {\r\n                                        return (\r\n                                            <Box sx={{ display: 'flex', flexDirection: 'column', gap: 0.5 }}>\r\n                                                {record.agentAssignments?.map((assignment: any, idx: number) => {\r\n                                                    const totalMinutes = assignment.vacations.reduce((acc: number, v: any) => {\r\n                                                        const { start, end } = getEventRange(v.date, v.start, v.end);\r\n                                                        const duration = (end.getTime() - start.getTime()) / (1000 * 60);\r\n                                                        return acc + duration;\r\n                                                    }, 0);\r\n                                                    const hours = Math.floor(totalMinutes / 60);\r\n                                                    const mins = totalMinutes % 60;\r\n                                                    const timeStr = mins > 0 ? `${hours}h${mins}` : `${hours}h`;\r\n\r\n                                                    return (\r\n                                                        <Typography key={idx} variant=\"body2\" noWrap>\r\n                                                            • <strong>{assignment.agentName}</strong>: {timeStr}\r\n                                                        </Typography>\r\n                                                    );\r\n                                                })}\r\n                                            </Box>\r\n                                        );\r\n                                    }}\r\n                                />\r\n\r\n                                <FunctionField\r\n                                    label=\"Total Mission\"\r\n                                    render={(record: any) => {\r\n                                        if (!record.agentAssignments) return '-';\r\n                                        let totalMinutesMission = 0;\r\n\r\n                                        record.agentAssignments.forEach((assignment: any) => {\r\n                                            const agentMins = assignment.vacations.reduce((acc: number, v: any) => {\r\n                                                const { start, end } = getEventRange(v.date, v.start, v.end);\r\n                                                const duration = (end.getTime() - start.getTime()) / (1000 * 60);\r\n                                                return acc + duration;\r\n                                            }, 0);\r\n                                            totalMinutesMission += agentMins;\r\n                                        });\r\n\r\n                                        const hours = Math.floor(totalMinutesMission / 60);\r\n                                        const mins = totalMinutesMission % 60;\r\n\r\n                                        return (\r\n                                            <Typography variant=\"body1\" fontWeight=\"bold\">\r\n                                                {mins > 0 ? `${hours}h${mins}` : `${hours}h`}\r\n                                            </Typography>\r\n                                        );\r\n                                    }}\r\n                                />\r\n\r\n                                <RaTextField source=\"notes\" label=\"Notes\" />\r\n                                <DeleteButton />\r\n                            </Datagrid>\r\n                        </List>\r\n                    )}\r\n                </div>\r\n\r\n            </CardContent>\r\n\r\n            <Dialog open={openDialog} onClose={handleCloseDialog} maxWidth=\"lg\" fullWidth>\r\n                <DialogTitle>{editMode ? 'Modifier la Mission' : 'Créer une Mission Multi-Agents'}</DialogTitle>\r\n                <DialogContent>\r\n                    <TextField\r\n                        select\r\n                        label=\"Site\"\r\n                        value={missionData.siteId}\r\n                        onChange={(e) => {\r\n                            setMissionData({ ...missionData, siteId: e.target.value });\r\n                            if (!editMode) {\r\n                                setAgentAssignments([{\r\n                                    agentId: '',\r\n                                    agentName: '',\r\n                                    specialty: '',\r\n                                    vacations: [{\r\n                                        date: moment().format('YYYY-MM-DD'),\r\n                                        start: '08:00',\r\n                                        end: '16:00'\r\n                                    }]\r\n                                }]);\r\n                            }\r\n                        }}\r\n                        fullWidth\r\n                        margin=\"normal\"\r\n                        required\r\n                    >\r\n                        {(sites || []).map((site: any) => (\r\n                            <MenuItem key={site.id} value={site.id}>\r\n                                {site.name}\r\n                            </MenuItem>\r\n                        ))}\r\n                    </TextField>\r\n\r\n                    <Box sx={{ mt: 3 }}>\r\n                        <Typography variant=\"h6\" gutterBottom>\r\n                            Agents Affectés\r\n                            <IconButton color=\"primary\" onClick={handleAddAgent} size=\"small\" sx={{ ml: 1 }}>\r\n                                <PersonAddIcon />\r\n                            </IconButton>\r\n                        </Typography>\r\n\r\n                        {agentAssignments.map((assignment, assignmentIdx) => (\r\n                            <Box key={assignmentIdx} sx={{ mb: 3, p: 2, border: '1px solid #ddd', borderRadius: 1 }}>\r\n                                <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>\r\n                                    <Typography variant=\"subtitle1\">Agent {assignmentIdx + 1}</Typography>\r\n                                    {agentAssignments.length > 1 && (\r\n                                        <IconButton color=\"error\" onClick={() => handleRemoveAgent(assignmentIdx)} size=\"small\">\r\n                                            <DeleteIcon />\r\n                                        </IconButton>\r\n                                    )}\r\n                                </Box>\r\n\r\n                                <Box sx={{ display: 'flex', gap: 2, mb: 2 }}>\r\n                                    <TextField\r\n                                        select\r\n                                        label=\"Spécialité\"\r\n                                        value={assignment.specialty}\r\n                                        onChange={(e) => handleAgentChange(assignmentIdx, 'specialty', e.target.value)}\r\n                                        fullWidth\r\n                                        required\r\n                                        disabled={!missionData.siteId}\r\n                                    >\r\n                                        {getApplicableSpecialties().map(s => (\r\n                                            <MenuItem key={s.id} value={s.id}>{s.name}</MenuItem>\r\n                                        ))}\r\n                                    </TextField>\r\n\r\n                                    <TextField\r\n                                        select\r\n                                        label=\"Agent\"\r\n                                        value={assignment.agentId}\r\n                                        onChange={(e) => handleAgentChange(assignmentIdx, 'agentId', e.target.value)}\r\n                                        fullWidth\r\n                                        required\r\n                                        disabled={!missionData.siteId}\r\n                                    >\r\n                                        {getAgentsForAssignment(assignment.specialty).map((agent: any) => (\r\n                                            <MenuItem key={agent.id} value={agent.id}>\r\n                                                {agent.firstName} {agent.lastName} ({agent.specialties?.join(', ') || 'N/A'})\r\n                                            </MenuItem>\r\n                                        ))}\r\n                                    </TextField>\r\n                                </Box>\r\n\r\n                                <Typography variant=\"subtitle2\" sx={{ mt: 2, mb: 1 }}>\r\n                                    Vacations\r\n                                    <IconButton color=\"primary\" onClick={() => handleAddVacation(assignmentIdx)} size=\"small\">\r\n                                        <AddIcon />\r\n                                    </IconButton>\r\n                                </Typography>\r\n\r\n                                {assignment.vacations.map((vacation, vacationIdx) => (\r\n                                    <Box key={vacationIdx} sx={{ display: 'flex', gap: 1, mb: 1, alignItems: 'center' }}>\r\n                                        <TextField\r\n                                            label=\"Date\"\r\n                                            type=\"date\"\r\n                                            value={vacation.date}\r\n                                            onChange={(e) => handleVacationChange(assignmentIdx, vacationIdx, 'date', e.target.value)}\r\n                                            InputLabelProps={{ shrink: true }}\r\n                                            size=\"small\"\r\n                                            required\r\n                                        />\r\n                                        <TextField\r\n                                            label=\"Début\"\r\n                                            type=\"time\"\r\n                                            value={vacation.start}\r\n                                            onChange={(e) => handleVacationChange(assignmentIdx, vacationIdx, 'start', e.target.value)}\r\n                                            InputLabelProps={{ shrink: true }}\r\n                                            size=\"small\"\r\n                                            required\r\n                                        />\r\n                                        <TextField\r\n                                            label=\"Fin\"\r\n                                            type=\"time\"\r\n                                            value={vacation.end}\r\n                                            onChange={(e) => handleVacationChange(assignmentIdx, vacationIdx, 'end', e.target.value)}\r\n                                            InputLabelProps={{ shrink: true }}\r\n                                            size=\"small\"\r\n                                            required\r\n                                        />\r\n                                        {assignment.vacations.length > 1 && (\r\n                                            <IconButton\r\n                                                color=\"error\"\r\n                                                onClick={() => handleRemoveVacation(assignmentIdx, vacationIdx)}\r\n                                                size=\"small\"\r\n                                            >\r\n                                                <DeleteIcon fontSize=\"small\" />\r\n                                            </IconButton>\r\n                                        )}\r\n                                    </Box>\r\n                                ))}\r\n                            </Box>\r\n                        ))}\r\n                    </Box>\r\n\r\n                    <TextField\r\n                        label=\"Notes / Instructions Générales\"\r\n                        value={missionData.notes}\r\n                        onChange={(e) => setMissionData({ ...missionData, notes: e.target.value })}\r\n                        fullWidth\r\n                        margin=\"normal\"\r\n                        multiline\r\n                        rows={3}\r\n                    />\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={handleCloseDialog}>Annuler</Button>\r\n                    <Button onClick={handleSaveMission} variant=\"contained\" color=\"primary\">\r\n                        {editMode ? 'Mettre à jour' : 'Créer Mission'}\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        </Card>\r\n    );\r\n};\r\n\r\nexport default Planning;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\pages\\Profile.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1147,1150],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1147,1150],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { Card, CardContent, CardHeader, Button, TextField } from '@mui/material';\r\nimport { Title, useNotify } from 'react-admin';\r\nimport { auth } from '../firebase';\r\nimport { updatePassword } from 'firebase/auth';\r\n\r\nconst Profile = () => {\r\n    const [password, setPassword] = useState('');\r\n    const [confirm, setConfirm] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const notify = useNotify();\r\n\r\n    const handleSubmit = async () => {\r\n        if (password !== confirm) {\r\n            notify(\"Les mots de passe ne correspondent pas\", { type: 'warning' });\r\n            return;\r\n        }\r\n        if (password.length < 6) {\r\n            notify(\"Le mot de passe doit faire au moins 6 caractères\", { type: 'warning' });\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        const user = auth.currentUser;\r\n\r\n        if (user) {\r\n            try {\r\n                await updatePassword(user, password);\r\n                notify(\"Mot de passe mis à jour avec succès\");\r\n                setPassword('');\r\n                setConfirm('');\r\n            } catch (error: any) {\r\n                notify(\"Erreur: \" + error.message, { type: 'error' });\r\n            }\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    return (\r\n        <Card>\r\n            <Title title=\"Mon Profil\" />\r\n            <CardHeader title=\"Gestion du Compte Admin\" />\r\n            <CardContent>\r\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem', maxWidth: '400px' }}>\r\n                    <h3>Changer mon mot de passe</h3>\r\n                    <TextField\r\n                        label=\"Nouveau mot de passe\"\r\n                        type=\"password\"\r\n                        value={password}\r\n                        onChange={e => setPassword(e.target.value)}\r\n                    />\r\n                    <TextField\r\n                        label=\"Confirmer mot de passe\"\r\n                        type=\"password\"\r\n                        value={confirm}\r\n                        onChange={e => setConfirm(e.target.value)}\r\n                    />\r\n                    <Button\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={handleSubmit}\r\n                        disabled={loading}\r\n                    >\r\n                        {loading ? \"Mise à jour...\" : \"Mettre à jour\"}\r\n                    </Button>\r\n                </div>\r\n            </CardContent>\r\n        </Card>\r\n    );\r\n};\r\n\r\nexport default Profile;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\pages\\Sites.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[502,505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[502,505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { List, Datagrid, TextField, Create, SimpleForm, TextInput, Edit, required, SelectArrayInput, FunctionField, DeleteButton } from 'react-admin';\r\n\r\nexport const SiteList = () => (\r\n    <List>\r\n        <Datagrid rowClick=\"edit\">\r\n            <TextField source=\"name\" label=\"Nom du Site\" />\r\n            <TextField source=\"address\" label=\"Adresse\" />\r\n            <TextField source=\"clientContact\" label=\"Contact Client\" />\r\n            <FunctionField label=\"Spécialités Requises\" render={(record: any) => record.requiredSpecialties ? record.requiredSpecialties.join(', ') : ''} />\r\n            <DeleteButton />\r\n        </Datagrid>\r\n    </List>\r\n);\r\n\r\nconst SiteForm = () => (\r\n    <SimpleForm sanitizeEmptyValues>\r\n        <TextInput source=\"name\" label=\"Nom du Site\" validate={required()} fullWidth />\r\n        <TextInput source=\"address\" label=\"Adresse (pour GPS)\" fullWidth />\r\n        <TextInput source=\"clientContact\" label=\"Nom du Contact / Téléphone\" fullWidth />\r\n        <TextInput source=\"email\" label=\"Email de contact\" type=\"email\" fullWidth />\r\n\r\n        <SelectArrayInput source=\"requiredSpecialties\" label=\"Spécialités Requises sur site\" choices={[\r\n            { id: 'ADS', name: 'Agent de Sécurité (ADS)' },\r\n            { id: 'SSIAP1', name: 'SSIAP 1' },\r\n            { id: 'SSIAP2', name: 'SSIAP 2' },\r\n            { id: 'CYNO', name: 'Agent Cynophile' },\r\n            { id: 'RONDIER', name: 'Rondier' },\r\n        ]} fullWidth />\r\n\r\n        <TextInput source=\"notes\" label=\"Notes internes\" multiline fullWidth />\r\n    </SimpleForm>\r\n);\r\n\r\nexport const SiteCreate = () => (\r\n    <Create title=\"Nouveau Site Client\">\r\n        <SiteForm />\r\n    </Create>\r\n);\r\n\r\nexport const SiteEdit = () => (\r\n    <Edit title=\"Modifier Site\">\r\n        <SiteForm />\r\n    </Edit>\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\theme.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\types\\models.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[484,487],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[484,487],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export interface Vacation {\r\n    date: string;\r\n    start: string;\r\n    end: string;\r\n}\r\n\r\nexport interface AgentAssignment {\r\n    agentId: string;\r\n    agentName: string;\r\n    specialty: string;\r\n    vacations: Vacation[];\r\n}\r\n\r\nexport interface Mission {\r\n    id: string;\r\n    siteId: string;\r\n    siteName: string;\r\n    agentAssignments: AgentAssignment[];\r\n    assignedAgentIds: string[];\r\n    status: 'scheduled' | 'completed' | 'cancelled';\r\n    notes?: string;\r\n    createdAt: any; // Firestore Timestamp or Date\r\n}\r\n\r\nexport interface Agent {\r\n    id: string;\r\n    firstName: string;\r\n    lastName: string;\r\n    email: string;\r\n    role: 'admin' | 'agent' | 'manager';\r\n    specialties?: string[];\r\n    status: 'active' | 'inactive';\r\n}\r\n\r\nexport interface Site {\r\n    id: string;\r\n    name: string;\r\n    address?: string;\r\n    requiredSpecialties?: string[];\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\utils\\imageUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\src\\utils\\planningUtils.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'current' is never reassigned. Use 'const' instead.","line":10,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":10,"endColumn":16,"fix":{"range":[327,355],"text":"const current = start.clone();"}},{"ruleId":"prefer-const","severity":2,"message":"'current' is never reassigned. Use 'const' instead.","line":46,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":46,"endColumn":16,"fix":{"range":[1366,1394],"text":"const current = start.clone();"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import moment from 'moment';\r\nimport type { Mission } from '../types/models';\r\n\r\nexport const calculateDuration = (start: moment.Moment, end: moment.Moment) => {\r\n    return moment.duration(end.diff(start)).asHours();\r\n};\r\n\r\nexport const getNightHours = (start: moment.Moment, end: moment.Moment) => {\r\n    let hours = 0;\r\n    let current = start.clone();\r\n\r\n    // Iterate by minute for precision\r\n    // Night is 21:00 to 06:00\r\n    while (current.isBefore(end)) {\r\n        const h = current.hour();\r\n        if (h >= 21 || h < 6) {\r\n            hours += 1 / 60;\r\n        }\r\n        current.add(1, 'minute');\r\n    }\r\n    return hours;\r\n};\r\n\r\nexport const isPublicHoliday = (date: moment.Moment) => {\r\n    const year = date.year();\r\n    const formatted = date.format('YYYY-MM-DD');\r\n    const holidays = [\r\n        `${year}-01-01`, // Jour de l'an\r\n        `${year}-05-01`, // Fête du travail\r\n        `${year}-05-08`, // Victoire 1945\r\n        `${year}-07-14`, // Fête nationale\r\n        `${year}-08-15`, // Assomption\r\n        `${year}-11-01`, // Toussaint\r\n        `${year}-11-11`, // Armistice\r\n        `${year}-12-25`, // Noël\r\n    ];\r\n    return holidays.includes(formatted);\r\n};\r\n\r\nexport const calculateVacationStats = (start: moment.Moment, end: moment.Moment) => {\r\n    let total = 0;\r\n    let night = 0;\r\n    let sunday = 0;\r\n    let holiday = 0;\r\n\r\n    let current = start.clone();\r\n\r\n    // Iterate by minute for precision\r\n    while (current.isBefore(end)) {\r\n        total += 1 / 60;\r\n\r\n        const h = current.hour();\r\n        // Night: 21h - 06h\r\n        if (h >= 21 || h < 6) {\r\n            night += 1 / 60;\r\n        }\r\n\r\n        // Sunday\r\n        if (current.day() === 0) {\r\n            sunday += 1 / 60;\r\n        }\r\n\r\n        // Holiday\r\n        if (isPublicHoliday(current)) {\r\n            holiday += 1 / 60;\r\n        }\r\n\r\n        current.add(1, 'minute');\r\n    }\r\n\r\n    return { total, night, sunday, holiday };\r\n};\r\n\r\nexport const calculateMissionStats = (missions: Mission[], now: moment.Moment = moment()) => {\r\n    let totalHours = 0;\r\n    let doneHours = 0;\r\n    let futureHours = 0;\r\n    const agentsSet = new Set<string>();\r\n    const sitesSet = new Set<string>();\r\n\r\n    missions.forEach((mission) => {\r\n        if (!mission.agentAssignments) return;\r\n\r\n        let isMissionActive = false;\r\n\r\n        mission.agentAssignments.forEach((assignment) => {\r\n            assignment.vacations.forEach((vacation) => {\r\n                const start = moment(`${vacation.date}T${vacation.start}`);\r\n                const end = moment(`${vacation.date}T${vacation.end}`);\r\n\r\n                if (end.isBefore(start)) end.add(1, 'day');\r\n\r\n                const stats = calculateVacationStats(start, end);\r\n                const duration = stats.total;\r\n\r\n                if (end.isAfter(now)) {\r\n                    futureHours += duration;\r\n                    agentsSet.add(assignment.agentId);\r\n                    isMissionActive = true;\r\n                } else {\r\n                    doneHours += duration;\r\n                }\r\n                totalHours += duration;\r\n            });\r\n        });\r\n\r\n        if (isMissionActive) {\r\n            sitesSet.add(mission.siteId);\r\n        }\r\n    });\r\n\r\n    return {\r\n        totalHours,\r\n        doneHours,\r\n        futureHours,\r\n        agentsCount: agentsSet.size,\r\n        sitesCount: sitesSet.size\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\abdel\\Desktop\\Mocyno3\\mocyno2\\admin\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]